<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos - Distribuidora MC</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SheetJS para exportar Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <i class="fas fa-drumstick-bite"></i>
                <h2>Distribuidora MC</h2>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="inventario.html">Inventario</a></li>
                <li><a href="clientes.html">Clientes</a></li>
                <li><a href="pedidos.html" class="active">Ventas</a></li>
            </ul>
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1><i class="fas fa-shopping-cart"></i> Gesti칩n de Ventas</h1>
            <p>Registra nuevas ventas y consulta el historial completo</p>
        </div>
    </section>

    <!-- Secci칩n de Pedidos -->
    <section class="orders">
        <div class="container">
            <!-- Tabs de Navegaci칩n -->
            <div class="orders-tabs">
                <button class="tab-btn active" data-tab="nuevo-pedido">
                    <i class="fas fa-cart-plus"></i> Nueva Venta
                </button>
                <button class="tab-btn" data-tab="historial">
                    <i class="fas fa-list"></i> Historial de Ventas
                </button>
            </div>

            <!-- TAB: NUEVO PEDIDO -->
            <div id="tabNuevoPedido" class="tab-content active">
                
                <!-- PASO 1: Selecci칩n de Cliente (se muestra primero) -->
                <div id="customerDataSection" class="customer-data-section">
                    <div class="customer-data-card">
                        <h3><i class="fas fa-user-circle"></i> Seleccionar Cliente</h3>
                        <p class="section-description">Elige un cliente existente para crear el pedido</p>
                        
                        <form id="customerDataForm" class="customer-form">
                            <!-- B칰squeda de Cliente -->
                            <div class="form-group full-width">
                                <label for="clientSearch">Buscar Cliente *</label>
                                <div class="client-search-wrapper">
                                    <input type="text" id="clientSearch" placeholder="Haz click para ver todos los clientes o busca por nombre/tel칠fono..." autocomplete="off" autofocus>
                                    <i class="fas fa-search"></i>
                                    <div id="clientSearchResults" class="client-search-results"></div>
                                </div>
                            </div>

                            <!-- Cliente Seleccionado (oculto por defecto) -->
                            <div id="selectedClientInfo" class="selected-client-info" style="display: none;">
                                <div class="selected-client-card">
                                    <div class="selected-client-header">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Cliente Seleccionado</span>
                                    </div>
                                    <div class="selected-client-details">
                                        <p><strong id="selectedClientName"></strong></p>
                                        <p><i class="fas fa-phone"></i> <span id="selectedClientPhone"></span></p>
                                        <p><i class="fas fa-map-marker-alt"></i> <span id="selectedClientAddress"></span></p>
                                        <p id="selectedClientEmailWrapper" style="display: none;"><i class="fas fa-envelope"></i> <span id="selectedClientEmail"></span></p>
                                    </div>
                                    <button type="button" class="btn-change-client" onclick="changeSelectedClient()">
                                        <i class="fas fa-exchange-alt"></i> Cambiar Cliente
                                    </button>
                                </div>
                            </div>

                            <!-- Bot칩n de continuar (se activa solo cuando hay cliente seleccionado) -->
                            <div class="form-actions">
                                <a href="clientes.html" class="btn btn-secondary">
                                    <i class="fas fa-user-plus"></i> Nuevo Cliente
                                </a>
                                <button type="submit" class="btn btn-primary btn-large" id="btnContinueOrder" disabled>
                                    <i class="fas fa-arrow-right"></i> Armar Venta
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- PASO 2: Armar Pedido (se muestra despu칠s de llenar datos del cliente) -->
                <div id="orderBuildSection" class="order-build-section" style="display: none;">
                    
                    <!-- Info del Cliente (resumida) -->
                    <div class="customer-info-bar">
                        <div class="customer-info-display">
                            <i class="fas fa-user"></i>
                            <div>
                                <strong id="displayCustomerName">Cliente</strong>
                                <span id="displayCustomerAddress">Direcci칩n</span>
                            </div>
                        </div>
                        <button class="btn-edit-customer" onclick="editCustomerData()">
                            <i class="fas fa-edit"></i> Editar Datos
                        </button>
                    </div>

                    <!-- Layout POS: 2 Columnas -->
                    <div class="pos-layout">
                        <!-- COLUMNA IZQUIERDA: Productos -->
                        <div class="pos-products-section">
                            <!-- Controles de Pedidos -->
                            <div class="orders-controls">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="orderSearchInput" placeholder="Buscar producto...">
                                </div>
                                <div class="filter-buttons" id="orderFilterButtons">
                                    <button class="filter-btn active" data-category="todos">
                                        <i class="fas fa-th"></i> Todos
                                    </button>
                                    <!-- Los filtros din치micos se cargar치n aqu칤 -->
                                </div>
                            </div>

                            <!-- Grid de Productos -->
                            <div class="products-order-grid" id="productsOrderGrid">
                                <!-- Los productos se cargar치n din치micamente -->
                            </div>

                            <!-- Mensaje cuando no hay productos -->
                            <div id="emptyOrderState" class="empty-state" style="display: none;">
                                <i class="fas fa-box-open"></i>
                                <h3>No hay productos disponibles</h3>
                                <p>Agrega productos en la secci칩n de inventario primero</p>
                                <a href="inventario.html" class="btn btn-primary">
                                    <i class="fas fa-plus"></i> Ir a Inventario
                                </a>
                            </div>
                        </div>

                        <!-- COLUMNA DERECHA: Carrito Activo -->
                        <div class="pos-cart-section">
                            <div class="pos-cart-sticky">
                                <div class="pos-cart-header">
                                    <h3><i class="fas fa-shopping-cart"></i> Pedido Actual</h3>
                                    <button class="btn-clear-mini" onclick="clearCartFromPos()" id="btnClearCartPos">
                                        <i class="fas fa-trash"></i> Vaciar
                                    </button>
                                </div>

                                <!-- Items del carrito -->
                                <div class="pos-cart-items" id="posCartItems">
                                    <div class="pos-empty-cart">
                                        <i class="fas fa-cart-arrow-down"></i>
                                        <p>Agrega productos al pedido</p>
                                    </div>
                                </div>

                                <!-- Totales -->
                                <div class="pos-cart-summary">
                                    <div class="pos-summary-row">
                                        <span>Subtotal:</span>
                                        <strong id="posSubtotal">$0.00</strong>
                                    </div>
                                    <div class="pos-summary-row pos-total">
                                        <span>Total a Cobrar:</span>
                                        <strong id="posTotal">$0.00</strong>
                                    </div>
                                    <div class="pos-items-count">
                                        <i class="fas fa-box"></i>
                                        <span id="posItemsCount">0 productos</span>
                                    </div>
                                </div>

                                <!-- Bot칩n de Checkout -->
                                <button class="btn-checkout-pos" id="btnCheckoutPos" onclick="confirmNewOrder()" disabled>
                                    <i class="fas fa-save"></i> Guardar Venta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: HISTORIAL DE PEDIDOS -->
            <div id="tabHistorial" class="tab-content">
                <!-- Filtros del Historial -->
                <div class="orders-history-controls">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="historySearchInput" placeholder="Buscar por n칰mero de venta o cliente...">
                    </div>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-status="todos">
                            <i class="fas fa-th"></i> Todas
                        </button>
                        <button class="filter-btn" data-status="pendiente">
                            <i class="fas fa-clock"></i> Por Entregar
                        </button>
                        <button class="filter-btn" data-status="entregado">
                            <i class="fas fa-check-circle"></i> Entregadas
                        </button>
                        <button class="filter-btn" data-status="cancelled">
                            <i class="fas fa-times-circle"></i> Cancelados
                        </button>
                        <button class="btn btn-success" id="exportAllOrdersBtn" style="margin-left: auto;">
                            <i class="fas fa-file-excel"></i> Exportar Todo a Excel
                        </button>
                    </div>
                </div>

                <!-- Lista de Pedidos -->
                <div class="orders-history-grid" id="ordersHistoryGrid">
                    <!-- Los pedidos se cargar치n din치micamente -->
                </div>

                <!-- Mensaje cuando no hay pedidos -->
                <div id="emptyHistoryState" class="empty-state" style="display: none;">
                    <i class="fas fa-receipt"></i>
                    <h3>No hay pedidos registrados</h3>
                    <p>Los pedidos que realices aparecer치n aqu칤</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal del Carrito -->
    <div id="cartModal" class="modal cart-modal">
        <div class="modal-content cart-modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-shopping-cart"></i> Carrito de Compras</h2>
                <button class="modal-close" id="cartModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="cart-body">
                <div id="cartItems" class="cart-items">
                    <!-- Items del carrito se cargar치n aqu칤 -->
                </div>
                <div id="emptyCart" class="empty-cart" style="display: none;">
                    <i class="fas fa-shopping-cart"></i>
                    <p>Tu carrito est치 vac칤o</p>
                </div>
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total:</span>
                    <span class="total-amount" id="cartTotal">$0.00</span>
                </div>
                <div class="cart-actions">
                    <button class="btn btn-cancel" id="btnClearCart">
                        <i class="fas fa-trash"></i> Vaciar Carrito
                    </button>
                    <button class="btn btn-primary" id="btnCheckout">
                        <i class="fas fa-check"></i> Finalizar Pedido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Checkout -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-invoice"></i> Finalizar Pedido</h2>
                <button class="modal-close" id="checkoutModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="checkoutForm">
                <div class="checkout-content">
                    <!-- Resumen del Pedido -->
                    <div class="order-summary">
                        <h3>Resumen del Pedido</h3>
                        <div id="checkoutItems" class="checkout-items">
                            <!-- Items se cargar치n aqu칤 -->
                        </div>
                        <div class="checkout-total">
                            <strong>Total:</strong>
                            <strong id="checkoutTotal">$0.00</strong>
                        </div>
                    </div>

                    <!-- Datos del Cliente -->
                    <div class="customer-info">
                        <h3>Datos del Cliente</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="customerName">Nombre Completo *</label>
                                <input type="text" id="customerName" required placeholder="Juan P칠rez" minlength="3" maxlength="100">
                            </div>
                            <div class="form-group">
                                <label for="customerPhone">Tel칠fono *</label>
                                <input type="tel" id="customerPhone" required placeholder="011 4567-8900" pattern="[0-9\s\-\+\(\)]{7,20}" title="Ingrese un tel칠fono v치lido (7-20 d칤gitos)">
                            </div>
                            <div class="form-group">
                                <label for="customerEmail">Email</label>
                                <input type="email" id="customerEmail" placeholder="juan@ejemplo.com" maxlength="100">
                            </div>
                            <div class="form-group">
                                <label for="customerAddress">Direcci칩n de Entrega *</label>
                                <input type="text" id="customerAddress" required placeholder="Av. Siempre Viva 123" minlength="5" maxlength="150">
                            </div>
                            <div class="form-group full-width">
                                <label for="orderNotes">Notas del Pedido</label>
                                <textarea id="orderNotes" rows="3" placeholder="Comentarios adicionales..." maxlength="500"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" id="btnCancelCheckout">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check-circle"></i> Confirmar Pedido
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmaci칩n -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content confirmation-content">
            <div class="confirmation-success">
                <i class="fas fa-check-circle"></i>
                <h2>춰Venta Registrada!</h2>
                <p>La venta ha sido guardada exitosamente</p>
                <div class="order-number">
                    <strong>N칰mero de Venta:</strong>
                    <span id="orderNumber">#0000</span>
                </div>
                <p class="confirmation-message">
                    La venta fue agregada al historial y est치 marcada como "Por Entregar".
                </p>
                <div class="confirmation-actions">
                    <button class="btn btn-primary" id="btnNewOrder">
                        <i class="fas fa-plus"></i> Nueva Venta
                    </button>
                    <button class="btn btn-secondary" id="btnViewOrders">
                        <i class="fas fa-list"></i> Ver Historial
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Futurista -->
    <footer class="footer-futuristic">
        <div class="footer-content">
            <!-- Columna 1: Marca -->
            <div class="footer-brand">
                <h3>MCDISTRIBUIDORA</h3>
                <p class="footer-slogan">"Sabor real, entrega puntual."</p>
                <p class="footer-description">Distribuci칩n para p칰blico general.</p>
            </div>
            
            <!-- Columna 2: Ubicaci칩n (destacada) -->
            <div class="footer-location">
                <h4>游꿢 Zona de trabajo</h4>
                <div class="footer-location-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Rojas, Buenos Aires, Argentina</span>
                </div>
                <div class="footer-location-item">
                    <i class="fas fa-truck"></i>
                    <span>Reparto: Lunes a Viernes</span>
                </div>
                <div class="footer-location-item">
                    <i class="fas fa-clock"></i>
                    <span>Atenci칩n: 24/7</span>
                </div>
            </div>
            
            <!-- Columna 3: Redes + CTA -->
            <div class="footer-social">
                <h4>Conect치 con nosotros</h4>
                <a href="https://instagram.com/mc_distribuidora_rojas" target="_blank" rel="noopener noreferrer" class="footer-social-link">
                    <i class="fab fa-instagram"></i>
                    <span>@mc_distribuidora_rojas</span>
                </a>
                <a href="https://instagram.com/mc_distribuidora_rojas" target="_blank" rel="noopener noreferrer" class="footer-cta">
                    <i class="fab fa-instagram"></i>
                    Seguinos en Instagram
                </a>
            </div>
        </div>
        
        <!-- Bottom -->
        <div class="footer-bottom">
            <p class="footer-copyright">
                &copy; 2025 MCDISTRIBUIDORA. Todos los derechos reservados.
            </p>
            <div class="footer-links">
                <a href="/privacidad">Pol칤tica de privacidad</a>
            </div>
        </div>
    </footer>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Configuraci칩n de Supabase -->
    <script src="supabase-config.js?v=6"></script>
    <!-- Scripts del proyecto -->
    <script src="inventory.js?v=6"></script>
    <script src="clientes.js?v=6"></script>
    <script src="orders-ventas.js?v=6"></script>
</body>
</html>
